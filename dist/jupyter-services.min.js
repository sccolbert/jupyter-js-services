"use strict";var jupyter;!function(t){var e;!function(t){var e;!function(t){function e(t){var e;return e="string"==typeof t?JSON.parse(t):r(t)}function n(t){var e;return e=t.buffers&&t.buffers.length?o(t):JSON.stringify(t)}function r(t){var e=new DataView(t),n=e.getUint32(0),r=[];if(2>n)throw new Error("Invalid incoming Kernel Message");for(var o=1;n>=o;o++)r.push(e.getUint32(4*o));var s=new Uint8Array(t.slice(r[0],r[1])),i=JSON.parse(new TextDecoder("utf8").decode(s));i.buffers=[];for(var o=1;n>o;o++){var a=r[o],u=r[o+1]||t.byteLength;i.buffers.push(new DataView(t.slice(a,u)))}return i}function o(t){var e=[],n=[],r=new TextEncoder("utf8"),o=r.encode(JSON.stringify(t,s));n.push(o.buffer);for(var i=0;i<t.buffers.length;i++){var a=t.buffers[i];n.push(a instanceof ArrayBuffer?a:a.buffer)}var u=n.length;for(e.push(4*(u+1)),i=0;i+1<n.length;i++)e.push(e[e.length-1]+n[i].byteLength);var h=new Uint8Array(e[e.length-1]+n[n.length-1].byteLength),l=new DataView(h.buffer);for(l.setUint32(0,u),i=0;i<e.length;i++)l.setUint32(4*(i+1),e[i]);for(i=0;i<n.length;i++)h.set(new Uint8Array(n[i]),e[i]);return h.buffer}function s(t,e){return"buffers"===t?void 0:e}t.deserialize=e,t.serialize=n}(e=t.serialize||(t.serialize={}))}(e=t.services||(t.services={}))}(jupyter||(jupyter={}));var __extends=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);n.prototype=e.prototype,t.prototype=new n},__decorate=this&&this.__decorate||function(t,e,n,r){if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)return Reflect.decorate(t,e,n,r);switch(arguments.length){case 2:return t.reduceRight(function(t,e){return e&&e(t)||t},e);case 3:return t.reduceRight(function(t,r){return void(r&&r(e,n))},void 0);case 4:return t.reduceRight(function(t,r){return r&&r(e,n,t)||t},r)}},jupyter;!function(t){var e;!function(t){function e(t){if(!t.hasOwnProperty("name")||!t.hasOwnProperty("id"))throw Error("Invalid kernel id");if("string"!=typeof t.id||"string"!=typeof t.name)throw Error("Invalid kernel id")}var n=phosphor.core.signal,r=phosphor.utility.Disposable,o="api/kernel",s=Logger.get("kernel"),i=function(){function r(e,n){this._id="",this._name="",this._baseUrl="",this._kernelUrl="",this._wsUrl="",this._username="",this._staticId="",this._ws=null,this._infoReply=null,this._reconnectLimit=7,this._autorestartAttempt=0,this._reconnectAttempt=0,this._handlerMap=null,this._iopubHandlers=null,this._status="",this._status="unknown",this._baseUrl=e,this._wsUrl=n,this._wsUrl||(this._wsUrl=location.protocol.replace("http","ws")+"//"+location.host),this._staticId=t.utils.uuid(),this._handlerMap=new Map,"undefined"==typeof WebSocket&&alert("Your browser does not have WebSocket support, please try Chrome, Safari, or Firefox â‰¥ 11.")}return r.list=function(n){var r=t.utils.urlJoinEncode(n,o);return t.utils.ajaxRequest(r,{method:"GET",dataType:"json"}).then(function(t){if(200===t.xhr.status){if(!Array.isArray(t.data))throw Error("Invalid kernel list");for(var n=0;n<t.data.length;n++)e(t.data[n]);return t.data}throw Error("Invalid Status: "+t.xhr.status)})},Object.defineProperty(r.prototype,"name",{get:function(){return this._name},set:function(t){this._name=t},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"isConnected",{get:function(){return null===this._ws?!1:this._ws.readyState!==WebSocket.OPEN?!1:!0},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"isFullyDisconnected",{get:function(){return null===this._ws},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"infoReply",{get:function(){return this._infoReply},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"status",{get:function(){return this._status},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"id",{get:function(){return this._id},set:function(e){this._id=e,this._kernelUrl=t.utils.urlJoinEncode(this._baseUrl,o,this._id)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"wsUrl",{get:function(){return[this._wsUrl,t.utils.urlJoinEncode(this._kernelUrl,"channels"),"?session_id="+this._staticId].join("")},enumerable:!0,configurable:!0}),r.prototype.getInfo=function(){var n=this;return t.utils.ajaxRequest(this._kernelUrl,{method:"GET",dataType:"json"}).then(function(t){if(200!==t.xhr.status)throw Error("Invalid Status: "+t.xhr.status);return e(t.data),t.data},function(t){n._onError(t)})},r.prototype.interrupt=function(){var e=this;this._handleStatus("interrupting");var n=t.utils.urlJoinEncode(this._kernelUrl,"interrupt");return t.utils.ajaxRequest(n,{method:"POST",dataType:"json"}).then(function(t){if(204!==t.xhr.status)throw Error("Invalid Status: "+t.xhr.status)},function(t){e._onError(t)})},r.prototype.restart=function(){var n=this;this._handleStatus("restarting"),this.disconnect();var r=t.utils.urlJoinEncode(this._kernelUrl,"restart");return t.utils.ajaxRequest(r,{method:"POST",dataType:"json"}).then(function(t){if(200!==t.xhr.status)throw Error("Invalid Status: "+t.xhr.status);return e(t.data),n.connect(),t.data},function(t){n._onError(t)})},r.prototype.start=function(n){var r=this;if(void 0!==n&&(this.id=n.id,this.name=n.name),!this._kernelUrl)throw Error("You must set the kernel id before starting.");return this._handleStatus("starting"),t.utils.ajaxRequest(this._kernelUrl,{method:"POST",dataType:"json"}).then(function(t){if(200!==t.xhr.status)throw Error("Invalid Status: "+t.xhr.status);return e(t.data),r.connect(t.data),t.data},function(t){r._onError(t)})},r.prototype.shutdown=function(){return this._handleStatus("shutdown"),this.disconnect(),t.utils.ajaxRequest(this._kernelUrl,{method:"DELETE",dataType:"json"}).then(function(t){if(204!==t.xhr.status)throw Error("Invalid response")})},r.prototype.connect=function(t){if(void 0!==t&&(this.id=t.id,this.name=t.name),!this._kernelUrl)throw Error("You must set the kernel id before starting");this._startChannels(),this._handleStatus("created")},r.prototype.reconnect=function(){this.isConnected||(this._reconnectAttempt=this._reconnectAttempt+1,this._handleStatus("reconnecting"),this._startChannels())},r.prototype.disconnect=function(){var t=this;null!==this._ws&&(this._ws.readyState===WebSocket.OPEN?(console.log("disconnect"),this._ws.onclose=function(){t._clearSocket()},this._ws.close()):(console.log("straight clearsocket"),this._clearSocket()))},r.prototype.sendShellMessage=function(e,n,r,o){var s=this;if(void 0===r&&(r={}),void 0===o&&(o=[]),!this.isConnected)throw new Error("kernel is not connected");var i=this._createMsg(e,n,r,o);i.channel="shell",this._ws.send(t.serialize.serialize(i));var a=new u(function(){s._handlerMap["delete"](i.header.msgId)});return this._handlerMap.set(i.header.msgId,a),a},r.prototype.kernelInfo=function(){return this.sendShellMessage("kernel_info_request",{})},r.prototype.inspect=function(t,e){var n={code:t,cursor_pos:e,detail_level:0};return this.sendShellMessage("inspect_request",n)},r.prototype.execute=function(e,n){var r={code:e,silent:!0,store_history:!1,user_expressions:{},allow_stdin:!1};return t.utils.extend(r,n),this.sendShellMessage("execute_request",r)},r.prototype.complete=function(t,e){var n={code:t,cursor_pos:e};return this.sendShellMessage("complete_request",n)},r.prototype.sendInputReply=function(e){if(!this.isConnected)throw new Error("kernel is not connected");var n={value:e},r=this._createMsg("input_reply",n);return r.channel="stdin",this._ws.send(t.serialize.serialize(r)),r.header.msgId},r.prototype._createMsg=function(e,n,r,o){void 0===r&&(r={}),void 0===o&&(o=[]);var s={header:{msgId:t.utils.uuid(),username:this._username,session:this._staticId,msgType:e,version:"5.0"},metadata:r||{},content:n,buffers:o||[],parentHeader:{}};return s},r.prototype._handleStatus=function(t){this.statusChanged.emit(t),this._status=t;var e="Kernel: "+t+" ("+this._id+")";"idle"===t||"busy"===t?s.debug(e):s.info(e)},r.prototype._onError=function(t){var e="API request failed ("+t.statusText+"): ";throw s.error(e),Error(t.statusText)},r.prototype._startChannels=function(){var t=this;this.disconnect();var e=this._wsUrl+this._kernelUrl;s.info("Starting WebSockets:",e),this._ws=new WebSocket(this.wsUrl),this._ws.binaryType="arraybuffer";var n=!1;this._ws.onclose=function(r){n||(n=!0,r.wasClean||t.getInfo().then(function(){this._ws_closed(e,!1)},function(){this._kernel_dead()}))},this._ws.onerror=function(r){n||(n=!0,t._wsClosed(e,!0))},this._ws.onopen=function(e){t._wsOpened(e)};var r=function(r){n||(n=!0,r.wasClean||t._wsClosed(e,!1))};setTimeout(function(){null!==t._ws&&(t._ws.onclose=r)},1e3),this._ws.onmessage=function(e){t._handleWSMessage(e)}},r.prototype._clearSocket=function(){console.log("_clearSocket"),this._ws&&this._ws.readyState===WebSocket.CLOSED&&(this._ws=null),this._handleStatus("disconnected")},r.prototype._kernelConnected=function(){var t=this;this._handleStatus("connected"),this._reconnectAttempt=0,this.kernelInfo().onReply(function(e){t._infoReply=e.content,t._handleStatus("ready"),t._autorestartAttempt=0})},r.prototype._kernelDead=function(){this._handleStatus("dead"),this.disconnect()},r.prototype._wsOpened=function(t){this.isConnected&&this._kernelConnected()},r.prototype._wsClosed=function(t,e){this.disconnect(),this._handleStatus("disconnected"),e&&(s.error("WebSocket connection failed: ",t),this._handleStatus("connectionFailed")),this._scheduleReconnect()},r.prototype._scheduleReconnect=function(){var t=this;if(this._reconnectAttempt<this._reconnectLimit){var e=Math.pow(2,this._reconnectAttempt);s.error("Connection lost, reconnecting in "+e+" seconds."),setTimeout(function(){t.reconnect()},1e3*e)}else this._handleStatus("connectionDead"),s.error("Failed to reconnect, giving up.")},r.prototype._handleWSMessage=function(e){try{var n=t.serialize.deserialize(e.data)}catch(r){return void s.error(r.message)}if("iopub"===n.channel&&"status"===n.msgType&&this._handleStatusMessage(n),n.parentHeader){var o=n.parentHeader,i=this._handlerMap.get(o.msgId);i&&i.handleMsg(n)}},r.prototype._handleStatusMessage=function(t){var e=this,n=t.content.execution_state;"dead"!==n&&this._handleStatus(n),"starting"===n?this.kernelInfo().onReply(function(t){e._infoReply=t.content,e._handleStatus("ready"),e._autorestartAttempt=0}):"restarting"===n?(this._autorestartAttempt=this._autorestartAttempt+1,this._handleStatus("autorestarting")):"dead"===n&&this._kernelDead()},__decorate([n],r.prototype,"statusChanged"),r}();t.Kernel=i;var a;!function(t){t[t.GotReply=1]="GotReply",t[t.GotIdle=2]="GotIdle",t[t.AutoDispose=4]="AutoDispose",t[t.IsDone=8]="IsDone"}(a||(a={}));var u=function(t){function e(){t.apply(this,arguments),this._status=0,this._input=null,this._output=null,this._reply=null,this._done=null}return __extends(e,t),Object.defineProperty(e.prototype,"autoDispose",{get:function(){return this._testFlag(a.AutoDispose)},set:function(t){t?this._setFlag(a.AutoDispose):this._clearFlag(a.AutoDispose)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isDone",{get:function(){return this._testFlag(a.IsDone)},enumerable:!0,configurable:!0}),e.prototype.onReply=function(t){return this._reply=t,this},e.prototype.onOutput=function(t){return this._output=t,this},e.prototype.onDone=function(t){return this._done=t,this},e.prototype.onInput=function(t){return this._input=t,this},e.prototype.handleMsg=function(t){if("iopub"===t.channel){var e=this._output;e&&e(t),"status"===t.msgType&&"idle"===t.content.execution_state&&(this._setFlag(a.GotIdle),this._testFlag(a.GotReply)&&this._handleDone(t))}else if("shell"===t.channel){var n=this._output;n&&n(t),this._setFlag(a.GotReply),this._testFlag(a.GotIdle)&&this._handleDone(t)}else if("stdin"===t.channel){var r=this._input;r&&r(t)}},e.prototype.dispose=function(){this._input=null,this._output=null,this._reply=null,this._done=null,t.prototype.dispose.call(this)},e.prototype._handleDone=function(t){this._setFlag(a.IsDone);var e=this._done;e&&e(t),this._reply=null,this._done=null,this._input=null,this._testFlag(a.AutoDispose)&&this.dispose()},e.prototype._testFlag=function(t){return 0!==(this._status&t)},e.prototype._setFlag=function(t){this._status|=t},e.prototype._clearFlag=function(t){this._status&=~t},e}(r);t.validateKernelId=e}(e=t.services||(t.services={}))}(jupyter||(jupyter={}));var __decorate=this&&this.__decorate||function(t,e,n,r){if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)return Reflect.decorate(t,e,n,r);switch(arguments.length){case 2:return t.reduceRight(function(t,e){return e&&e(t)||t},e);case 3:return t.reduceRight(function(t,r){return void(r&&r(e,n))},void 0);case 4:return t.reduceRight(function(t,r){return r&&r(e,n,t)||t},r)}},jupyter;!function(t){var e;!function(t){function e(e){if(!e.hasOwnProperty("id")||!e.hasOwnProperty("notebook")||!e.hasOwnProperty("kernel"))throw Error("Invalid Session Model");if(t.validateKernelId(e.kernel),"string"!=typeof e.id)throw Error("Invalid Session Model");n(e.notebook)}function n(t){if(!t.hasOwnProperty("path")||"string"!=typeof t.path)throw Error("Invalid Notebook Model")}var r=phosphor.core.signal,o="api/sessions",s=Logger.get("session"),i=function(){function n(e){this._id="unknown",this._notebookPath="unknown",this._baseUrl="unknown",this._sessionUrl="unknown",this._wsUrl="unknown",this._kernel=null,this._id=t.utils.uuid(),this._notebookPath=e.notebookPath,this._baseUrl=e.baseUrl,this._wsUrl=e.wsUrl,this._kernel=new t.Kernel(this._baseUrl,this._wsUrl),this._sessionUrl=t.utils.urlJoinEncode(this._baseUrl,o,this._id)}return n.list=function(n){var r=t.utils.urlJoinEncode(n,o);return t.utils.ajaxRequest(r,{method:"GET",dataType:"json"}).then(function(t){if(200!==t.xhr.status)throw Error("Invalid Status: "+t.xhr.status);if(!Array.isArray(t.data))throw Error("Invalid Session list");for(var n=0;n<t.data.length;n++)e(t.data[n]);return t.data})},Object.defineProperty(n.prototype,"kernel",{get:function(){return this._kernel},enumerable:!0,configurable:!0}),n.prototype.start=function(){var n=this,r=t.utils.urlJoinEncode(this._baseUrl,o);return t.utils.ajaxRequest(r,{method:"POST",dataType:"json",data:JSON.stringify(this._model),contentType:"application/json"}).then(function(t){if(201!==t.xhr.status)throw Error("Invalid response");return e(t.data),n._kernel.connect(t.data.kernel),n._handleStatus("kernelCreated"),t.data},function(t){n._handleStatus("kernelDead")})},n.prototype.getInfo=function(){return t.utils.ajaxRequest(this._sessionUrl,{method:"GET",dataType:"json"}).then(function(t){if(200!==t.xhr.status)throw Error("Invalid response");return e(t.data),t.data})},n.prototype["delete"]=function(){return this._kernel&&(this._handleStatus("kernelKilled"),this._kernel.disconnect()),t.utils.ajaxRequest(this._sessionUrl,{method:"DELETE",dataType:"json"}).then(function(t){if(204!==t.xhr.status)throw Error("Invalid response");e(t.data)},function(t){if(410===t.xhr.status)throw Error("The kernel was deleted but the session was not");throw Error(t.statusText)})},n.prototype.restart=function(t){var e=this;return this["delete"]().then(function(){return e.start()})["catch"](function(){return e.start()}).then(function(){t&&t.notebookPath&&(e._notebookPath=t.notebookPath),t&&t.kernelName&&(e._kernel.name=t.kernelName)})},n.prototype.renameNotebook=function(n){return this._notebookPath=n,t.utils.ajaxRequest(this._sessionUrl,{method:"PATCH",dataType:"json",data:JSON.stringify(this._model),contentType:"application/json"}).then(function(t){if(200!==t.xhr.status)throw Error("Invalid response");return e(t.data),t.data})},Object.defineProperty(n.prototype,"_model",{get:function(){return{id:this._id,notebook:{path:this._notebookPath},kernel:{name:this._kernel.name,id:this._kernel.id}}},enumerable:!0,configurable:!0}),n.prototype._handleStatus=function(t){this.statusChanged.emit(t),s.error("Session: "+t+" ("+this._id+")")},__decorate([r],n.prototype,"statusChanged"),n}();t.NotebookSession=i}(e=t.services||(t.services={}))}(jupyter||(jupyter={}));var jupyter;!function(t){var e;!function(t){var e;!function(t){function e(t,n){t=t||{};for(var r in n)t[r]="object"==typeof n[r]?e(t[r],n[r]):n[r];return t}function n(){for(var t=[],e="0123456789ABCDEF",n=0;32>n;n++)t[n]=e.charAt(Math.floor(16*Math.random()));return t[12]="4",t[16]=e.charAt(3&Number(t[16])|8),t.join("")}function r(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];for(var n="",r=0;r<t.length;r++)""!==t[r]&&(n.length>0&&"/"!=n.charAt(n.length-1)?n=n+"/"+t[r]:n+=t[r]);return n.replace(/\/\/+/,"/")}function o(t){return t.split("/").map(encodeURIComponent).join("/")}function s(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];return o(r.apply(null,t))}function i(t){return"?"+Object.keys(t).map(function(e){return encodeURIComponent(e)+"="+encodeURIComponent(t[e])}).join("&")}function a(t,e){return new Promise(function(n,r){var o=new XMLHttpRequest;o.open(e.method,t),e.contentType&&o.overrideMimeType(e.contentType),o.onload=function(){var t=o.response;"json"===e.dataType&&(t=JSON.parse(o.response)),n({data:t,statusText:o.statusText,xhr:o})},o.onerror=function(t){r({xhr:o,statusText:o.statusText,error:t})},e.data?o.send(e.data):o.send()})}t.extend=e,t.uuid=n,t.urlPathJoin=r,t.encodeURIComponents=o,t.urlJoinEncode=s,t.browser=function(){if("undefined"==typeof navigator)return["None"];var t,e=navigator.appName,n=navigator.userAgent,r=n.match(/(opera|chrome|safari|firefox|msie)\/?\s*(\.?\d+(\.\d+)*)/i);return r&&null!==(t=n.match(/version\/([\.\d]+)/i))&&(r[2]=t[1]),r=r?[r[1],r[2]]:[e,navigator.appVersion,"-?"]}(),t.jsonToQueryString=i,t.ajaxRequest=a}(e=t.utils||(t.utils={}))}(e=t.services||(t.services={}))}(jupyter||(jupyter={}));